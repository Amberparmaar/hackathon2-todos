# Agent Behavior Rules

This document defines the behavior and operational rules for all AI agents working on the "Evolution of Todo" project. All agents MUST read and comply with these rules before any action.

## Authority

This document references the project constitution at `.specify/memory/constitution.md`. The constitution is the supreme authority for all development decisions.

## Core Operating Principles

### 1. Constitution First

- **Rule**: Always read `.specify/memory/constitution.md` before any action
- **Enforcement**: No code generation, no planning, no task creation without constitution validation
- **Reference**: @.specify/memory/constitution.md

### 2. Spec-Driven Workflow

The only allowed workflow is:
```
Specify → Plan → Tasks → Implement
```

No shortcuts. No skipping steps. Each phase must be complete before proceeding.

### 3. Zero Manual Coding

- **Rule**: Code can only be generated by Claude Code
- **Enforcement**: If code is incorrect, update the spec and regenerate
- **Reference**: @.specify/memory/constitution.md - Principle II

### 4. Phase Isolation

- **Rule**: Work only within the current phase directory
- **Enforcement**: Never cross phase boundaries
- **Reference**: @.specify/memory/constitution.md - Principle VII

## Agent-Specific Instructions

### Claude Code (Primary AI Agent)

#### Before ANY Action

1. Read constitution: `.specify/memory/constitution.md`
2. Read current phase specs: `@phaseX/specs/specify.md`
3. Validate tech stack compliance
4. Check phase completion status

#### During Implementation

1. Reference Task IDs in code comments
2. Link to spec sections: `# @phaseX/specs/plan.md:section`
3. Follow PEP8 (Python), TypeScript standards, Tailwind conventions
4. Include docstrings for all functions
5. Handle errors gracefully

#### Forbidden Actions

- Manual code editing (after generation)
- Skipping the Specify → Plan → Tasks → Implement workflow
- Using technologies not in phase specs
- Crossing phase boundaries
- Generating code without Task ID reference

#### Bonus Feature Priority

When specs allow:
1. Prioritize reusable intelligence via subagents
2. Use agent skills where possible
3. Create reusable blueprints
4. Document bonus implementations clearly

### Subagents and Skills

#### Reusable Intelligence

- Identify repeatable patterns across phases
- Encapsulate as reusable subagents
- Document skill usage in specs
- Link to Constitution Principle IV

#### Cloud-Native Blueprints

- Create Helm charts via kubectl-ai/kagent
- Document Dapr component patterns
- Share across phase4 and phase5
- Reference Constitution Principle IV

## Phase-Specific Constraints

### Phase 1: In-Memory Python Console App
- **Tech**: Pure Python only
- **Storage**: In-memory (no database)
- **UI**: Console-based
- **Constraints**: No external dependencies beyond stdlib

### Phase 2: Full-Stack Web App
- **Tech**: Next.js (App Router + Tailwind), FastAPI, Neon PostgreSQL, Better Auth (JWT)
- **Features**: Basic CRUD + User Authentication
- **Constraints**: Use only specified libraries

### Phase 3: AI-Powered Chatbot
- **Tech**: OpenAI ChatKit UI, FastAPI, OpenAI Agents SDK, Official MCP SDK
- **Features**: Basic CRUD + Natural Language Interface
- **Constraints**: Stateless server design

### Phase 4: Local Kubernetes Deployment
- **Tech**: Docker, Minikube, Helm, kubectl-ai/kagent
- **Features**: Containerized deployment
- **Constraints**: Use Gordon for Dockerfiles if available

### Phase 5: Advanced Cloud Deployment
- **Tech**: Dapr, Kafka/Redpanda, Cloud K8s
- **Features**: Event-driven architecture + all advanced features
- **Constraints**: Cloud K8s deployment only

## Compliance Checklist

Before any agent action, verify:

- [ ] Constitution read and understood
- [ ] Current phase identified
- [ ] Tech stack validated
- [ ] Phase specs read (specify.md, plan.md, tasks.md)
- [ ] Task ID available for code generation
- [ ] No manual edits planned
- [ ] Phase isolation maintained

## Error Handling

If an agent encounters:

### Missing Requirements
1. Stop implementation
2. Request spec update
3. Do NOT improvise

### Tech Stack Violation
1. Stop implementation
2. Alert to constitution violation
3. Request approval before proceeding

### Phase Boundary Cross
1. Stop implementation
2. Return to current phase
3. Alert to principle VII violation

## Documentation Requirements

All agents MUST:

1. Comment code with Task ID references
2. Link to spec sections in complex logic
3. Document any deviations from specs
4. Update implement.md with iterations
5. Include rationale for decisions

## Enforcement

All generated output MUST pass:
- Constitution compliance check
- Phase-specific tech stack validation
- Code quality standards (PEP8, TypeScript, Tailwind)
- Documentation completeness check

Non-compliant output MUST be regenerated.

**Reference**: @.specify/memory/constitution.md
**Version**: 1.0.0
